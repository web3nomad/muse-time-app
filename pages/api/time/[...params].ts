// Next.js API route support: https://nextjs.org/docs/api-routes/introduction
import type { NextApiRequest, NextApiResponse } from 'next'
import { queryOnChainItemId, ResourceTypes } from '@/lib/arweave'
import type { TopicData, ProfileData } from '@/lib/arweave'
import { controllerContract, nftContract } from '@/lib/ethereum/public'
import type { TimeTokenData, TimeTroveData } from '@/lib/ethereum/types'

// const generateSVG = (topic: TopicData, timeToken: TimeTokenData) => `
// <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 600 800">
//   <rect width="600" height="800" rx="15" ry="15" stroke="#292929" stroke-width="10" stroke-linecap="round" fill="#E0DDD6"/>
//   <path transform="translate(36,40)" d="M10.88 13.48C10.96 15.64 12.64 17.32 14.8 17.32C16.88 17.32 18.64 15.64 18.64 13.48C18.64 11.32 16.88 9.64 14.8 9.64C14.16 9.64 13.6 9.8 13.04 10.04C14 8.04 15.36 6.36 16.4 5.4L15.28 4.76C13.84 6.04 10.88 9.24 10.88 13.48ZM0.4 13.48C0.4 15.64 2.16 17.32 4.24 17.32C6.4 17.32 8.16 15.64 8.16 13.48C8.16 11.32 6.4 9.64 4.24 9.64C3.68 9.64 3.04 9.8 2.56 10.04C3.44 8.04 4.88 6.36 5.84 5.4L4.72 4.76C3.28 6.04 0.4 9.24 0.4 13.48ZM23.5363 11.16C25.2163 8.04 27.6163 5.96 30.8163 5.96H42.7363V57.08C42.7363 60.2 41.1363 62.68 38.8163 63H56.4163C54.0963 62.68 52.4963 60.2 52.4963 57.08V5.96H64.4163C67.6163 5.96 70.0163 8.04 71.6963 11.16H72.1763L69.6163 4.28H25.6163L23.0563 11.16H23.5363ZM61.025 21.32C63.105 21.56 64.545 23.8 64.545 26.52V57.72C64.545 60.52 63.105 62.68 61.025 63H76.625C74.545 62.68 73.105 60.52 73.105 57.72V26.52C73.105 23.8 74.545 21.56 76.625 21.32H66.385C72.065 19.96 74.625 15.48 74.625 11.64C74.545 10.44 73.985 7 70.385 7C69.585 7 68.865 7.24 68.225 7.72C69.985 3.48 74.385 1.4 78.705 1.4C87.905 1.4 90.385 9 90.385 15.96C90.385 19.4 87.505 21.32 82.785 21.32H79.265C81.345 21.56 82.785 23.8 82.785 26.52V57.72C82.785 60.52 81.345 62.68 79.265 63H94.865C92.785 62.68 91.345 60.52 91.345 57.72V34.04C91.985 26.28 95.265 23.08 98.065 23.08C101.505 23.08 102.385 27.48 102.385 32.52V57.72C102.385 60.52 101.025 62.68 98.945 63H114.545C112.465 62.68 111.025 60.52 111.025 57.72V34.2C111.585 26.28 114.945 23.08 117.745 23.08C121.185 23.08 122.065 27.48 122.065 32.52V57.72C122.065 60.52 120.625 62.68 118.545 63H134.145C132.065 62.68 130.705 60.52 130.705 57.72V32.76C130.705 23.4 125.345 20.12 120.385 20.12C116.385 20.12 112.225 23.32 110.865 29.96C109.905 22.76 105.185 20.12 100.785 20.12C96.785 20.12 92.785 22.92 91.345 29.56V15.64C91.345 7.16 87.425 0.599998 78.225 0.599998C72.305 0.599998 66.385 4.84 66.385 11.16C66.385 13.48 68.145 15.32 70.385 15.32C71.425 15.32 72.385 14.92 73.105 14.2C71.185 19.88 65.345 21.32 61.025 21.32ZM137.725 42.12C137.725 54.6 145.965 64.2 157.885 64.2C165.165 64.2 169.965 60.84 171.885 52.6H170.605C169.405 57.16 166.605 62.12 161.245 62.12C156.925 62.12 152.525 58.68 149.565 53.32C146.365 46.36 151.325 38.92 159.885 37.8C168.605 36.68 171.725 34.28 171.725 30.36C171.725 25.72 166.205 20.12 156.605 20.12C146.205 20.12 137.725 28.6 137.725 42.12ZM157.885 21.16C164.045 21.16 166.285 25.8 166.285 29C166.285 32.36 164.445 35.4 157.965 37C151.725 38.52 147.405 43.16 147.325 48.28C147.245 48.04 147.165 47.72 147.085 47.48C143.005 35.32 148.685 21.16 157.885 21.16ZM199.389 26.52V57.72C199.389 60.52 197.949 62.68 195.869 63H211.469C209.389 62.68 207.949 60.52 207.949 57.72V26.52C207.949 23.8 209.389 21.56 211.469 21.32H201.229C206.909 19.96 209.469 15.48 209.469 11.64C209.469 10.44 208.829 7 205.229 7C202.989 7 201.229 8.84 201.229 11.16C201.229 13.48 202.989 15.32 205.229 15.32C206.269 15.32 207.229 14.92 207.949 14.2C206.029 19.88 200.189 21.32 195.869 21.32C197.949 21.56 199.389 23.8 199.389 26.52ZM214.834 51.08C214.834 59.16 220.034 64.2 228.434 64.2C233.954 64.2 243.794 60.84 243.794 52.44C243.794 39.16 223.074 37 223.074 28.2C223.074 23.16 227.234 21 230.914 21C238.274 21 241.474 28.68 240.114 34.76L240.754 35C241.474 32.92 242.834 31.32 244.514 29.08C244.514 26.12 239.154 20.12 230.754 20.12C224.594 20.12 216.514 22.92 216.514 31C216.514 43.72 236.754 45.48 236.754 55.64C236.754 60.36 232.674 63.16 227.794 63.16C219.714 63.16 218.674 53.4 222.434 48.2L216.674 44.68C215.714 45.96 214.834 48.44 214.834 51.08ZM268.525 63H284.125C282.045 62.68 280.605 60.52 280.605 57.72V34.2C281.245 26.28 284.525 23.08 287.325 23.08C290.845 23.08 291.645 27.48 291.645 32.52V57.72C291.645 60.52 290.285 62.68 288.205 63H303.805C301.725 62.68 300.285 60.52 300.285 57.72V34.2C300.845 26.28 304.205 23.08 307.005 23.08C310.445 23.08 311.325 27.48 311.325 32.52V57.72C311.325 60.52 309.965 62.68 307.885 63H323.485C321.325 62.68 319.965 60.52 319.965 57.72V32.76C319.965 23.4 314.685 20.12 309.645 20.12C305.725 20.12 301.485 23.32 300.125 29.96C299.165 22.76 294.445 20.12 290.045 20.12C286.045 20.12 282.045 22.92 280.605 29.56V21.32H268.525C270.605 21.56 272.045 23.8 272.045 26.52V57.72C272.045 60.52 270.605 62.68 268.525 63ZM327.022 42.12C327.022 54.28 335.022 64.2 344.942 64.2C354.862 64.2 362.862 54.28 362.862 42.12C362.862 29.96 354.862 20.12 344.942 20.12C335.022 20.12 327.022 29.96 327.022 42.12ZM341.022 21.64C341.262 21.56 341.582 21.56 341.822 21.56C346.862 21.56 352.302 29.64 354.382 40.36C356.542 51.64 354.062 61.56 348.862 62.6C348.542 62.68 348.302 62.68 347.982 62.68C343.022 62.68 337.502 54.6 335.502 43.96C333.342 32.68 335.822 22.68 341.022 21.64ZM366.884 63H382.484C380.404 62.68 378.964 60.52 378.964 57.72V34.2C379.604 26.28 384.244 23.08 388.164 23.08C392.964 23.08 396.564 27.48 396.564 32.52V57.72C396.564 60.52 395.124 62.68 393.044 63H408.644C406.564 62.68 405.124 60.52 405.124 57.72V32.76C405.124 25.24 399.364 20.12 391.444 20.12C386.724 20.12 380.724 22.84 378.964 29.8V21.32H366.884C368.964 21.56 370.404 23.8 370.404 26.52V57.72C370.404 60.52 368.964 62.68 366.884 63ZM412.256 42.12C412.256 54.6 420.496 64.2 432.416 64.2C439.696 64.2 444.496 60.84 446.416 52.6H445.136C443.936 57.16 441.136 62.12 435.776 62.12C431.456 62.12 427.056 58.68 424.096 53.32C420.896 46.36 425.856 38.92 434.416 37.8C443.136 36.68 446.256 34.28 446.256 30.36C446.256 25.72 440.736 20.12 431.136 20.12C420.736 20.12 412.256 28.6 412.256 42.12ZM432.416 21.16C438.576 21.16 440.816 25.8 440.816 29C440.816 32.36 438.976 35.4 432.496 37C426.256 38.52 421.936 43.16 421.856 48.28C421.776 48.04 421.696 47.72 421.616 47.48C417.536 35.32 423.216 21.16 432.416 21.16ZM452.06 26.52L459.5 53.16C465.66 55.32 474.06 61 474.06 68.2C474.06 73.32 470.7 77.8 464.06 77.8C453.26 77.8 453.74 63.56 454.38 61.8L453.66 61.4C452.7 63.16 449.9 66.76 447.34 68.68C449.34 73.08 456.06 78.92 465.58 78.92C477.02 78.92 482.7 74.44 482.7 67.8C482.7 63.72 479.66 58.28 469.26 55.88C471.34 46.84 481.1 38.68 481.1 26.92C481.1 24.44 480.78 22.92 480.14 21.24H474.22C477.58 24.28 478.7 28.12 478.7 31.08C478.7 38.36 471.02 45.96 468.46 54.36L460.7 26.52C459.9 23.64 460.62 21.56 462.7 21.32H447.1C449.18 21.56 451.18 23.4 452.06 26.52ZM488.168 63.32C490.328 63.32 492.088 61.56 492.088 59.48C492.088 57.32 490.328 55.64 488.168 55.64C486.088 55.64 484.328 57.32 484.328 59.48C484.328 61.56 486.088 63.32 488.168 63.32ZM518.614 8.68C518.614 10.76 520.374 12.52 522.534 12.52C523.094 12.52 523.734 12.36 524.214 12.12C523.334 14.04 521.894 15.72 520.934 16.76L522.054 17.4C523.494 16.04 526.374 12.92 526.374 8.68C526.374 6.52 524.614 4.76 522.534 4.76C520.374 4.76 518.534 6.52 518.614 8.68ZM508.134 8.68C508.134 10.76 509.894 12.52 511.974 12.52C512.614 12.52 513.174 12.36 513.734 12.12C512.774 14.04 511.414 15.72 510.374 16.76L511.494 17.4C512.934 16.04 515.894 12.92 515.894 8.68C515.814 6.52 514.134 4.76 511.974 4.76C509.894 4.76 508.134 6.52 508.134 8.68Z" fill="#292929"/>
//   <text style="font-size:30px;"><tspan class="n" text-anchor="middle" x="50%" y="20%">${topic.name}</tspan></text>
// </svg>
// `

const generateSVG = (profile: ProfileData, topic: TopicData, timeToken: TimeTokenData, tokenOwner: string) => `
<svg width="1440" height="1387" viewBox="0 0 1440 1387" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <style>
      .h1{font-family:serif;font-size:60px;font-weight:bold;}
      .h2{font-family:sans-serif;font-size:50px;}
      .p{font-family:sans-serif;font-size:40px;}
      .s{font-family:sans-serif;font-size:30px;fill:#999999;}
    </style>
  </defs>
  <g fill="none">
    <rect width="1440" height="1387" fill="#E0DDD6"/>
    <path d="M1273 455V455C1275.76 455 1278 457.239 1278 460V505C1278 507.761 1275.76 510 1273 510V510V455Z" fill="#292929"/>
    <path d="M163 394C163 391.239 165.239 389 168 389V389V421V421C165.239 421 163 418.761 163 416V394Z" fill="#292929"/>
    <path d="M163 460C163 457.239 165.239 455 168 455V455V510V510C165.239 510 163 507.761 163 505V460Z" fill="#292929"/>
    <path d="M163 527C163 524.239 165.239 522 168 522V522V577V577C165.239 577 163 574.761 163 572V527Z" fill="#292929"/>
    <path d="M465.705 118.156C465.787 120.363 467.503 122.079 469.709 122.079C471.834 122.079 473.631 120.363 473.631 118.156C473.631 115.95 471.834 114.234 469.709 114.234C469.055 114.234 468.483 114.397 467.911 114.642C468.892 112.6 470.281 110.884 471.343 109.903L470.199 109.249C468.728 110.557 465.705 113.825 465.705 118.156ZM455 118.156C455 120.363 456.798 122.079 458.922 122.079C461.129 122.079 462.926 120.363 462.926 118.156C462.926 115.95 461.129 114.234 458.922 114.234C458.35 114.234 457.697 114.397 457.206 114.642C458.105 112.6 459.576 110.884 460.557 109.903L459.413 109.249C457.942 110.557 455 113.825 455 118.156Z" fill="#292929"/>
    <path d="M478.633 115.787C480.349 112.6 482.8 110.475 486.069 110.475H498.244V162.692C498.244 165.878 496.61 168.412 494.24 168.739H512.218C509.848 168.412 508.214 165.878 508.214 162.692V110.475H520.389C523.658 110.475 526.11 112.6 527.826 115.787H528.316L525.701 108.759H480.757L478.142 115.787H478.633Z" fill="#292929"/>
    <path d="M516.925 126.164C519.05 126.41 520.521 128.698 520.521 131.476V163.345C520.521 166.205 519.05 168.412 516.925 168.739H532.86C530.735 168.412 529.265 166.205 529.265 163.345V131.476C529.265 128.698 530.735 126.41 532.86 126.164H522.4C528.202 124.775 530.817 120.199 530.817 116.277C530.735 115.051 530.163 111.537 526.486 111.537C525.669 111.537 524.934 111.782 524.28 112.273C526.078 107.942 530.572 105.817 534.985 105.817C544.382 105.817 546.915 113.58 546.915 120.689C546.915 124.203 543.973 126.164 539.152 126.164H535.557C537.681 126.41 539.152 128.698 539.152 131.476V163.345C539.152 166.205 537.681 168.412 535.557 168.739H551.491C549.367 168.412 547.896 166.205 547.896 163.345V139.157C548.55 131.231 551.9 127.962 554.76 127.962C558.274 127.962 559.173 132.457 559.173 137.605V163.345C559.173 166.205 557.783 168.412 555.659 168.739H571.593C569.469 168.412 567.998 166.205 567.998 163.345V139.321C568.57 131.231 572.002 127.962 574.862 127.962C578.376 127.962 579.275 132.457 579.275 137.605V163.345C579.275 166.205 577.804 168.412 575.679 168.739H591.614C589.489 168.412 588.1 166.205 588.1 163.345V137.85C588.1 128.289 582.625 124.939 577.559 124.939C573.473 124.939 569.224 128.207 567.835 134.99C566.854 127.635 562.033 124.939 557.538 124.939C553.453 124.939 549.367 127.799 547.896 134.581V120.363C547.896 111.701 543.892 105 534.494 105C528.447 105 522.4 109.331 522.4 115.787C522.4 118.156 524.198 120.036 526.486 120.036C527.549 120.036 528.529 119.627 529.265 118.892C527.303 124.694 521.338 126.164 516.925 126.164Z" fill="#292929"/>
    <path d="M595.271 147.411C595.271 160.158 603.687 169.964 615.863 169.964C623.299 169.964 628.202 166.532 630.163 158.115H628.856C627.63 162.773 624.77 167.84 619.295 167.84C614.883 167.84 610.388 164.326 607.365 158.851C604.096 151.742 609.162 144.142 617.906 142.998C626.813 141.854 630 139.402 630 135.398C630 130.659 624.362 124.939 614.556 124.939C603.933 124.939 595.271 133.601 595.271 147.411ZM615.863 126.001C622.155 126.001 624.443 130.741 624.443 134.009C624.443 137.441 622.564 140.546 615.945 142.181C609.571 143.733 605.158 148.473 605.077 153.703C604.995 153.458 604.913 153.131 604.831 152.886C600.664 140.465 606.466 126.001 615.863 126.001Z" fill="#292929"/>
    <path d="M658.257 131.476V163.345C658.257 166.205 656.786 168.412 654.662 168.739H670.596C668.472 168.412 667.001 166.205 667.001 163.345V131.476C667.001 128.698 668.472 126.41 670.596 126.164H660.137C665.938 124.775 668.553 120.199 668.553 116.277C668.553 115.051 667.9 111.537 664.222 111.537C661.934 111.537 660.137 113.417 660.137 115.787C660.137 118.156 661.934 120.036 664.222 120.036C665.285 120.036 666.265 119.627 667.001 118.892C665.04 124.694 659.074 126.164 654.662 126.164C656.786 126.41 658.257 128.698 658.257 131.476Z" fill="#292929"/>
    <path d="M674.034 156.563C674.034 164.816 679.346 169.964 687.926 169.964C693.564 169.964 703.615 166.532 703.615 157.952C703.615 144.387 682.451 142.181 682.451 133.192C682.451 128.044 686.7 125.838 690.459 125.838C697.977 125.838 701.246 133.682 699.856 139.893L700.51 140.138C701.246 138.013 702.635 136.379 704.351 134.091C704.351 131.067 698.876 124.939 690.296 124.939C684.003 124.939 675.75 127.799 675.75 136.052C675.75 149.045 696.424 150.843 696.424 161.221C696.424 166.042 692.257 168.902 687.272 168.902C679.019 168.902 677.956 158.933 681.797 153.621L675.914 150.026C674.933 151.333 674.034 153.866 674.034 156.563Z" fill="#292929"/>
    <path d="M728.876 168.739H744.811C742.686 168.412 741.216 166.205 741.216 163.345V139.321C741.869 131.231 745.22 127.962 748.08 127.962C751.675 127.962 752.492 132.457 752.492 137.605V163.345C752.492 166.205 751.103 168.412 748.979 168.739H764.913C762.789 168.412 761.318 166.205 761.318 163.345V139.321C761.89 131.231 765.322 127.962 768.182 127.962C771.696 127.962 772.595 132.457 772.595 137.605V163.345C772.595 166.205 771.205 168.412 769.081 168.739H785.015C782.809 168.412 781.42 166.205 781.42 163.345V137.85C781.42 128.289 776.027 124.939 770.878 124.939C766.874 124.939 762.543 128.207 761.154 134.99C760.174 127.635 755.352 124.939 750.858 124.939C746.772 124.939 742.686 127.799 741.216 134.581V126.164H728.876C731.001 126.41 732.472 128.698 732.472 131.476V163.345C732.472 166.205 731.001 168.412 728.876 168.739Z" fill="#292929"/>
    <path d="M788.628 147.411C788.628 159.831 796.8 169.964 806.932 169.964C817.065 169.964 825.237 159.831 825.237 147.411C825.237 134.99 817.065 124.939 806.932 124.939C796.8 124.939 788.628 134.99 788.628 147.411ZM802.928 126.491C803.174 126.41 803.5 126.41 803.746 126.41C808.894 126.41 814.45 134.663 816.575 145.613C818.781 157.135 816.248 167.268 810.937 168.33C810.61 168.412 810.365 168.412 810.038 168.412C804.971 168.412 799.333 160.158 797.29 149.29C795.084 137.768 797.617 127.554 802.928 126.491Z" fill="#292929"/>
    <path d="M829.346 168.739H845.28C843.156 168.412 841.685 166.205 841.685 163.345V139.321C842.339 131.231 847.078 127.962 851.082 127.962C855.985 127.962 859.662 132.457 859.662 137.605V163.345C859.662 166.205 858.191 168.412 856.067 168.739H872.001C869.877 168.412 868.406 166.205 868.406 163.345V137.85C868.406 130.169 862.522 124.939 854.432 124.939C849.611 124.939 843.483 127.717 841.685 134.826V126.164H829.346C831.47 126.41 832.941 128.698 832.941 131.476V163.345C832.941 166.205 831.47 168.412 829.346 168.739Z" fill="#292929"/>
    <path d="M875.691 147.411C875.691 160.158 884.108 169.964 896.283 169.964C903.719 169.964 908.622 166.532 910.584 158.115H909.276C908.05 162.773 905.19 167.84 899.715 167.84C895.303 167.84 890.808 164.326 887.785 158.851C884.516 151.742 889.583 144.142 898.326 142.998C907.233 141.854 910.42 139.402 910.42 135.398C910.42 130.659 904.782 124.939 894.976 124.939C884.353 124.939 875.691 133.601 875.691 147.411ZM896.283 126.001C902.575 126.001 904.863 130.741 904.863 134.009C904.863 137.441 902.984 140.546 896.365 142.181C889.991 143.733 885.578 148.473 885.497 153.703C885.415 153.458 885.333 153.131 885.252 152.886C881.084 140.465 886.886 126.001 896.283 126.001Z" fill="#292929"/>
    <path d="M916.348 131.476L923.948 158.687C930.24 160.894 938.82 166.696 938.82 174.05C938.82 179.28 935.388 183.856 928.606 183.856C917.574 183.856 918.064 169.311 918.718 167.513L917.983 167.104C917.002 168.902 914.142 172.579 911.527 174.54C913.57 179.035 920.434 185 930.158 185C941.844 185 947.646 180.424 947.646 173.641C947.646 169.474 944.54 163.917 933.917 161.466C936.042 152.232 946.011 143.897 946.011 131.885C946.011 129.351 945.684 127.799 945.031 126.083H938.984C942.416 129.188 943.56 133.11 943.56 136.134C943.56 143.57 935.715 151.333 933.1 159.913L925.174 131.476C924.357 128.534 925.092 126.41 927.217 126.164H911.282C913.407 126.41 915.449 128.289 916.348 131.476Z" fill="#292929"/>
    <path d="M953.231 169.065C955.437 169.065 957.235 167.268 957.235 165.143C957.235 162.937 955.437 161.221 953.231 161.221C951.106 161.221 949.309 162.937 949.309 165.143C949.309 167.268 951.106 169.065 953.231 169.065Z" fill="#292929"/>
    <path d="M984.33 113.253C984.33 115.378 986.128 117.176 988.334 117.176C988.906 117.176 989.56 117.012 990.05 116.767C989.152 118.728 987.681 120.444 986.7 121.507L987.844 122.16C989.315 120.771 992.257 117.584 992.257 113.253C992.257 111.047 990.459 109.249 988.334 109.249C986.128 109.249 984.249 111.047 984.33 113.253ZM973.626 113.253C973.626 115.378 975.423 117.176 977.548 117.176C978.202 117.176 978.774 117.012 979.346 116.767C978.365 118.728 976.976 120.444 975.914 121.507L977.058 122.16C978.529 120.771 981.552 117.584 981.552 113.253C981.47 111.047 979.754 109.249 977.548 109.249C975.423 109.249 973.626 111.047 973.626 113.253Z" fill="#292929"/>
    <path d="M869.465 213.922C869.276 213.827 869.086 213.78 868.683 213.732C868.612 213.732 868.399 213.709 868.233 213.685C867.831 213.638 867.215 213.614 866.764 213.638C866.599 213.638 866.48 213.638 866.385 213.638C866.101 213.638 865.911 213.709 865.84 213.804C865.793 213.804 865.509 214.325 865.509 214.396C865.509 214.443 865.509 214.467 865.556 214.491C865.603 214.514 865.675 214.538 865.698 214.514C865.698 214.491 865.793 214.491 865.935 214.491C867.143 214.491 868.281 214.585 869.465 214.704C869.513 214.704 869.513 214.68 869.536 214.68C869.655 214.656 869.726 214.467 869.726 214.277C869.726 214.088 869.678 214.017 869.465 213.922Z" fill="#292929"/>
    <path d="M875.608 219.466C875.75 218.945 876.343 218.471 877.385 217.973C877.646 217.855 878.143 217.642 878.191 217.642C878.191 217.642 878.238 217.642 878.262 217.665C878.309 217.689 878.356 217.689 878.404 217.713C878.451 217.713 878.475 217.689 878.522 217.689C878.641 217.689 878.664 217.642 878.712 217.523L878.759 217.428L878.949 217.381C879.92 217.144 881.152 216.789 881.744 216.67C882.242 216.576 883.616 216.339 884.09 216.339C884.114 216.315 884.09 216.362 883.9 216.528C881.863 218.305 879.115 220.106 876.319 220.177C876.058 220.177 875.869 220.177 875.727 220.129C875.679 220.129 875.679 220.106 875.656 220.058C875.632 220.035 875.608 219.94 875.584 219.916C875.561 219.798 875.561 219.584 875.608 219.466ZM875.205 219.987C875.442 220.84 876.461 221.172 877.243 221.148C880.039 221.124 884.185 218.163 885.962 216.173C886.056 216.078 886.104 216.031 886.246 216.031C886.341 216.031 886.672 215.983 887.028 215.912C887.525 215.817 888.07 215.794 888.781 215.723C888.852 215.723 888.876 215.723 888.923 215.746C888.97 215.77 888.994 215.77 889.042 215.77C889.16 215.77 889.231 215.628 889.207 215.509C889.184 215.391 889.042 215.344 888.828 215.344C888.473 215.344 887.525 215.486 886.72 215.58C886.578 215.604 886.459 215.604 886.459 215.604C886.459 215.604 886.506 215.533 886.554 215.486C887.146 214.893 888.07 213.069 888.212 212.311C888.354 211.529 888.26 210.818 887.952 210.226C887.312 208.994 885.962 208.686 884.682 208.662C884.469 208.662 884.232 208.662 884.161 208.686C884.114 208.686 884.043 208.686 884.043 208.686C884.043 208.686 884.256 208.52 884.516 208.307C885.322 207.667 885.701 207.336 886.033 206.957C886.72 206.151 887.075 205.346 887.004 204.73C886.886 203.64 885.843 203.403 884.919 203.403C882.266 203.403 878.262 206.056 878.262 208.994C878.262 209.563 878.356 209.776 878.641 209.823C878.664 209.823 878.712 209.847 878.735 209.823C878.807 209.823 878.901 209.8 878.925 209.776C878.996 209.705 878.972 209.681 878.949 209.61C878.925 209.539 878.878 209.515 878.759 209.515C878.712 209.515 878.688 209.492 878.688 209.468C878.664 209.421 878.664 208.781 878.688 208.615C879.043 206.056 882.408 203.782 884.919 203.782C885.346 203.782 886.104 203.829 886.364 204.232C886.412 204.279 886.412 204.279 886.364 204.54C886.151 205.701 884.611 207.028 883.735 207.762C883.166 208.236 883.024 208.378 882.976 208.544C882.929 208.733 883.095 209.018 883.284 209.113C883.332 209.136 883.403 209.136 883.474 209.16C883.545 209.16 883.616 209.136 883.687 209.136C884.043 209.136 884.374 209.041 884.682 209.041C885.417 209.041 886.435 209.207 886.98 209.681C887.122 209.8 887.312 209.965 887.336 210.037C887.336 210.06 887.359 210.108 887.383 210.131C887.454 210.25 887.454 210.368 887.454 210.629C887.454 212.24 886.412 213.827 885.369 215.012C885.085 215.32 884.587 215.865 884.564 215.865C884.564 215.865 884.398 215.888 884.208 215.912C882.526 216.125 880.844 216.457 879.209 216.931C879.02 216.978 878.854 217.002 878.854 217.002C878.807 216.978 879.304 215.604 879.825 214.277C879.896 214.112 879.991 213.875 880.039 213.756C880.086 213.638 880.133 213.543 880.133 213.519C880.133 213.211 882.811 206.957 883.19 206.151C883.403 205.701 883.45 205.535 883.474 205.393C883.545 204.99 883.332 204.801 882.763 204.777C882.597 204.777 882.479 204.801 882.431 204.848C882.384 204.872 882.36 204.943 882.289 205.085C882.242 205.18 882.1 205.44 881.981 205.654C881.744 206.08 881.555 206.53 881.342 207.075C880.82 208.425 880.583 208.876 880.204 209.823C879.754 210.984 877.835 215.865 877.835 216.955C877.835 217.12 877.835 217.144 877.859 217.239C877.883 217.286 877.906 217.334 877.883 217.334C877.883 217.334 877.812 217.357 877.74 217.405C877.409 217.618 876.816 217.808 876.485 218.021C875.75 218.495 875.276 218.945 875.182 219.49C875.158 219.608 875.182 219.869 875.205 219.987Z" fill="#292929"/>
    <path d="M888.257 215.699C888.257 215.746 888.257 215.794 888.257 215.865C888.328 216.504 888.92 216.789 889.513 216.789C889.726 216.789 889.868 216.789 890.176 216.718C890.65 216.599 891.029 216.433 891.929 216.031C892.142 215.936 892.356 215.817 892.427 215.794C892.521 215.77 892.664 215.699 892.758 215.652C892.948 215.557 893.611 215.32 893.777 215.249C893.825 215.225 893.896 215.201 893.896 215.201C894.014 215.13 894.014 214.941 893.896 214.893C893.872 214.893 893.848 214.87 893.825 214.893C893.777 214.893 893.706 214.893 893.635 214.917C892.901 215.154 892.166 215.486 891.479 215.841C890.863 216.149 890.2 216.433 889.513 216.433C889.323 216.433 889.323 216.41 889.276 216.339C889.181 216.196 889.205 215.888 889.299 215.533C889.347 215.367 889.418 215.13 889.442 215.13C890.152 214.941 891.384 214.491 891.55 213.661C891.621 213.282 891.479 213.069 891.1 212.951C891.029 212.927 890.958 212.927 890.816 212.927C890.768 212.927 890.721 212.927 890.673 212.927C889.56 212.998 888.399 214.42 888.257 215.533C888.257 215.604 888.257 215.675 888.257 215.699ZM889.844 214.443C890.058 214.183 890.484 213.804 890.768 213.638C890.91 213.567 891.171 213.424 891.171 213.448C891.171 213.993 890.342 214.538 889.844 214.656C889.75 214.68 889.678 214.704 889.678 214.704C889.655 214.68 889.75 214.562 889.844 214.443Z" fill="#292929"/>
    <path d="M893.295 216.86C893.295 217.12 893.366 217.263 893.603 217.381C893.722 217.452 893.793 217.452 893.84 217.428C893.982 217.428 894.053 217.286 894.124 217.168C894.551 216.291 896.209 214.799 897.181 214.348C897.394 214.254 897.678 214.135 897.773 214.135H897.797V214.277C897.797 214.348 897.773 214.585 897.726 214.822C897.607 215.415 897.607 215.746 897.702 216.078C897.868 216.67 898.223 216.931 898.839 216.931C899.1 216.931 899.242 216.907 899.502 216.789C899.763 216.67 901.114 215.723 901.185 215.533C901.208 215.438 901.161 215.367 901.066 215.32C901.042 215.296 901.019 215.296 900.995 215.296C900.924 215.296 900.853 215.344 900.734 215.462C900.403 215.794 899.384 216.576 898.886 216.576C898.602 216.576 898.484 216.362 898.484 216.102C898.484 215.912 898.531 215.746 898.626 215.344C898.721 214.917 898.768 214.775 898.768 214.585C898.768 214.064 898.531 213.756 897.986 213.732C897.939 213.732 897.868 213.756 897.797 213.756C897.11 213.78 895.996 214.585 895.475 215.059C895.285 215.249 894.788 215.746 894.551 215.983C894.48 216.054 894.432 216.102 894.432 216.102C894.432 216.102 894.456 215.983 894.527 215.817C894.598 215.652 894.646 215.533 894.646 215.509C894.669 215.462 894.859 215.012 894.906 214.87C894.977 214.68 895.119 214.348 895.262 213.993C895.427 213.567 895.522 213.282 895.475 213.116C895.427 212.927 895.262 212.808 895.025 212.785C894.977 212.785 894.954 212.785 894.906 212.785C894.764 212.785 894.598 212.927 894.551 213.069C894.527 213.116 894.48 213.188 894.456 213.211C893.84 214.017 893.461 215.58 893.295 216.599C893.295 216.623 893.295 216.741 893.295 216.86Z" fill="#292929"/>
    <path d="M894.663 227C896.156 227 897.696 225.294 898.454 224.157C899.591 222.451 900.847 219.513 901.344 217.547L901.392 217.357L901.652 217.239C903.263 216.504 904.377 215.96 904.851 215.391C904.969 215.249 904.993 215.201 904.945 215.107C904.922 215.036 904.874 214.988 904.803 214.988C904.708 214.988 904.661 215.012 904.543 215.154C904.211 215.533 903.619 215.912 902.718 216.362C902.434 216.504 901.51 216.907 901.51 216.907C901.51 216.907 901.557 216.694 901.605 216.457C901.747 215.699 901.865 215.178 901.936 214.585C901.96 214.42 902.008 214.135 902.031 213.993C902.102 213.543 902.126 213.33 902.126 212.903C902.126 212.477 902.102 212.477 902.031 212.382C901.96 212.287 901.865 212.264 901.747 212.264C901.534 212.264 901.392 212.358 901.297 212.595C901.249 212.737 901.202 212.927 901.084 213.59C900.823 215.107 900.681 215.652 900.491 216.41C900.444 216.599 900.254 217.168 900.231 217.334L900.207 217.452L899.946 217.547C897.459 218.447 892.365 221.243 892.246 224.346C892.246 225.981 893.005 227 894.663 227ZM893.052 223.067C894.118 220.887 896.819 219.395 898.928 218.4C899.283 218.234 900.041 217.902 900.065 217.902C900.065 217.926 899.733 218.897 899.544 219.395C898.572 221.977 896.866 225.247 894.118 226.289C893.976 226.337 893.763 226.384 893.644 226.384C893.076 226.384 892.649 225.247 892.649 224.702C892.625 224.086 892.744 223.707 893.052 223.067ZM901.936 211.671C902.008 211.695 902.079 211.742 902.173 211.719C902.197 211.719 902.244 211.719 902.268 211.719C902.624 211.719 902.837 211.316 902.671 211.008C902.576 210.842 902.41 210.724 902.221 210.724C901.984 210.724 901.7 210.842 901.628 211.103C901.581 211.34 901.7 211.577 901.936 211.671Z" fill="#292929"/>
    <path d="M903.859 217.357C903.907 217.736 904.262 217.926 904.617 217.926C904.665 217.926 904.759 217.902 904.807 217.879C904.925 217.831 905.186 217.689 905.399 217.5C905.612 217.31 906.371 216.599 907.223 215.817C908.195 214.917 908.787 214.372 908.811 214.396C908.835 214.396 908.882 214.68 908.953 215.059C909.024 215.438 909.048 215.675 909.119 215.841C909.237 216.102 909.403 216.339 909.545 216.457C909.687 216.576 909.901 216.623 910.043 216.623C910.588 216.623 911.749 215.438 911.749 215.13C911.749 215.036 911.606 214.964 911.512 214.988C911.441 215.012 911.393 215.059 911.204 215.32C911.133 215.438 910.422 216.173 910.303 216.173C910.043 216.173 909.853 215.012 909.83 214.846C909.759 214.443 909.664 213.922 909.143 213.922C909.048 213.922 909.024 213.922 908.953 213.946C908.882 213.969 908.835 213.993 908.811 213.993C908.692 213.993 908.361 214.23 907.697 214.87C907.413 215.13 904.949 217.5 904.759 217.5C904.736 217.476 904.736 217.405 904.736 217.286C904.736 215.96 907.342 213.211 908.692 213.116C908.74 213.116 908.787 213.116 908.811 213.14C908.858 213.188 908.953 213.282 909 213.424C909.071 213.638 909.119 213.709 909.237 213.709C909.261 213.709 909.261 213.709 909.285 213.709C909.403 213.709 909.474 213.567 909.403 213.472C909.379 213.448 909.356 213.377 909.356 213.33C909.356 213.211 909.143 212.903 909.048 212.832C908.763 212.619 908.574 212.619 908.266 212.619C908.171 212.619 908.1 212.619 908.053 212.595C907.934 212.595 907.839 212.619 907.65 212.69C906.11 213.235 904.12 215.083 903.859 216.812C903.836 216.978 903.836 217.239 903.859 217.357Z" fill="#292929"/>
    <path d="M910.828 218.471C910.875 218.66 911.017 218.731 911.207 218.731C911.444 218.731 911.491 218.684 911.657 218.21C911.823 217.713 911.941 217.452 912.368 216.765C912.96 215.817 913.671 215.012 914.192 214.325C914.311 214.159 914.855 213.661 914.855 213.685C914.855 213.685 914.855 213.804 914.832 213.922C914.737 214.372 914.784 214.585 914.784 215.012C914.784 215.557 914.784 216.41 915.543 216.41C915.685 216.41 915.708 216.41 915.732 216.386C915.756 216.362 915.803 216.291 915.851 216.22C916.301 215.533 916.466 215.083 917.035 214.372C917.201 214.183 918.646 212.5 918.883 212.5C918.883 212.643 918.859 213.116 918.836 213.211C918.812 213.306 918.765 214.04 918.765 214.23C918.765 215.272 919.167 217.026 920.494 217.026C921.252 217.026 922.342 216.007 922.697 215.32C922.745 215.225 922.745 215.107 922.626 215.059C922.579 215.036 922.555 215.036 922.508 215.036C922.461 215.036 922.413 215.059 922.366 215.13C922.058 215.604 921.229 216.647 920.565 216.623C919.76 216.599 919.665 215.604 919.665 214.988C919.665 214.704 919.689 214.633 919.76 213.993C919.854 213.116 919.854 212.998 919.854 212.69C919.854 212.358 919.76 211.908 919.333 211.908C918.457 211.908 916.277 214.538 915.898 215.296C915.874 215.344 915.851 215.415 915.827 215.415C915.827 215.415 915.851 214.988 915.898 214.633C915.993 213.922 915.969 213.567 915.898 213.33C915.851 213.14 915.732 213.022 915.566 212.998C915.543 212.998 915.519 212.998 915.471 212.998C915.282 212.998 915.045 213.093 914.761 213.282C913.813 213.898 912.51 215.604 912.036 216.576C911.965 216.718 911.918 216.741 911.941 216.718C911.941 216.41 913.221 213.496 913.41 213.093C913.979 211.861 914.121 211.577 914.121 211.316C914.121 210.961 913.979 210.818 913.623 210.818C913.552 210.818 913.505 210.818 913.458 210.842C913.434 210.866 913.41 210.866 913.387 210.866C913.221 210.866 912.486 212.406 912.391 212.643C911.823 213.875 910.828 216.102 910.828 217.476C910.828 217.618 910.804 217.76 910.804 217.808C910.804 217.973 910.804 218.4 910.828 218.471Z" fill="#292929"/>
    <path d="M925.04 211.979C925.325 211.695 925.254 211.269 924.875 211.103C924.78 211.055 924.709 211.055 924.614 211.055C924.353 211.055 924.116 211.197 924.022 211.458C923.998 211.553 923.998 211.695 924.045 211.813C924.14 212.027 924.353 212.169 924.59 212.145C924.756 212.145 924.922 212.098 925.04 211.979ZM923.24 217.192C923.5 217.192 923.808 217.12 924.14 216.978C924.33 216.907 924.448 216.812 924.756 216.599C925.017 216.41 925.183 216.315 925.491 216.078C926.059 215.652 926.367 215.32 926.415 215.249C926.486 215.13 926.391 214.988 926.249 214.988C926.201 214.988 926.059 215.059 926.059 215.083C926.059 215.201 924.59 216.268 924.282 216.481C923.998 216.694 923.572 216.836 923.311 216.812C923.264 216.812 923.24 216.812 923.216 216.812C923.169 216.812 923.169 216.812 923.169 216.765C923.169 216.102 923.761 214.585 924.093 213.969C924.282 213.614 924.282 213.519 924.282 213.353C924.282 213.211 924.282 213.188 924.259 213.14C924.164 212.951 923.974 212.832 923.785 212.856C923.643 212.856 923.524 212.856 923.406 212.974C922.979 213.401 922.245 215.036 922.245 215.675C922.221 215.865 922.268 216.244 922.316 216.457C922.411 216.884 922.837 217.168 923.24 217.192Z" fill="#292929"/>
    <path d="M925.756 216.86C925.756 217.12 925.827 217.263 926.064 217.381C926.182 217.452 926.254 217.452 926.301 217.428C926.443 217.428 926.514 217.286 926.585 217.168C927.012 216.291 928.67 214.799 929.641 214.348C929.855 214.254 930.139 214.135 930.234 214.135H930.257V214.277C930.257 214.348 930.234 214.585 930.186 214.822C930.068 215.415 930.068 215.746 930.163 216.078C930.329 216.67 930.684 216.931 931.3 216.931C931.561 216.931 931.703 216.907 931.963 216.789C932.224 216.67 933.574 215.723 933.645 215.533C933.669 215.438 933.622 215.367 933.527 215.32C933.503 215.296 933.48 215.296 933.456 215.296C933.385 215.296 933.314 215.344 933.195 215.462C932.864 215.794 931.845 216.576 931.347 216.576C931.063 216.576 930.945 216.362 930.945 216.102C930.945 215.912 930.992 215.746 931.087 215.344C931.181 214.917 931.229 214.775 931.229 214.585C931.229 214.064 930.992 213.756 930.447 213.732C930.4 213.732 930.329 213.756 930.257 213.756C929.57 213.78 928.457 214.585 927.936 215.059C927.746 215.249 927.249 215.746 927.012 215.983C926.941 216.054 926.893 216.102 926.893 216.102C926.893 216.102 926.917 215.983 926.988 215.817C927.059 215.652 927.106 215.533 927.106 215.509C927.13 215.462 927.32 215.012 927.367 214.87C927.438 214.68 927.58 214.348 927.722 213.993C927.888 213.567 927.983 213.282 927.936 213.116C927.888 212.927 927.722 212.808 927.485 212.785C927.438 212.785 927.414 212.785 927.367 212.785C927.225 212.785 927.059 212.927 927.012 213.069C926.988 213.116 926.941 213.188 926.917 213.211C926.301 214.017 925.922 215.58 925.756 216.599C925.756 216.623 925.756 216.741 925.756 216.86Z" fill="#292929"/>
    <path d="M943.471 217.902C943.377 218.731 943.14 220.011 942.5 220.651C942.429 220.722 942.31 220.816 942.287 220.816C942.263 220.793 942.239 220.485 942.216 220.2C942.192 219.94 942.192 219.727 942.216 219.608C942.216 219.584 942.216 219.49 942.239 219.395C942.381 218.803 942.5 217.618 942.713 216.694C942.926 215.77 943.116 215.107 943.163 214.988C943.187 214.941 943.329 215.604 943.377 216.031C943.448 216.694 943.519 217.476 943.471 217.902ZM940.533 209.113C940.368 208.97 940.249 208.852 940.249 208.828C940.249 208.781 940.818 208.307 941.197 208.07C941.765 207.715 942.879 207.075 943.637 206.791C944.466 206.483 945.272 206.151 945.272 206.175C945.296 206.175 945.248 206.269 945.201 206.412C945.153 206.53 945.059 206.743 945.011 206.862C944.419 208.307 943.85 209.776 943.4 211.269C943.353 211.411 943.211 211.648 943.163 211.885L943.14 212.003L942.832 212.05C942.666 212.074 942.524 212.098 942.524 212.098C942.524 212.098 942.5 212.05 942.476 211.979C942.168 211.079 941.221 209.776 940.533 209.113ZM939.491 214.04C939.538 214.064 939.562 214.088 939.61 214.088C939.704 214.088 939.799 214.04 939.989 213.969C940.841 213.661 941.671 213.353 942.547 213.116C942.571 213.116 942.666 213.33 942.666 213.377C942.666 213.472 942.145 215.083 942.026 215.462C941.955 215.675 941.884 216.007 941.837 216.173C941.647 216.86 941.481 217.523 941.363 218.21C941.197 219.158 941.173 219.821 941.292 220.414C941.363 220.793 941.457 221.03 941.86 221.148C941.931 221.172 942.002 221.195 942.073 221.172C943.258 221.124 943.756 218.826 943.827 217.926C943.85 217.713 943.85 217.168 943.827 216.907C943.756 216.125 943.637 215.272 943.448 214.562C943.424 214.443 943.377 214.325 943.4 214.301C943.424 214.183 943.874 212.808 943.898 212.808C944.111 212.595 947.215 212.287 947.807 212.287C948.304 212.287 948.447 212.311 948.565 212.358C948.66 212.406 948.684 212.406 948.707 212.406C948.897 212.382 948.944 212.169 948.802 212.074C948.257 211.719 946.978 211.695 946.314 211.695C945.627 211.695 944.917 211.719 944.229 211.813C944.206 211.79 944.869 209.989 945.177 209.207C945.225 209.065 945.367 208.733 945.485 208.497C945.604 208.26 945.698 207.928 945.746 207.809C945.864 207.525 946.101 206.933 946.267 206.577C946.528 206.009 946.575 205.843 946.575 205.843C946.859 205.559 949.916 205.132 950.721 205.038C951.764 204.895 952.782 204.848 953.825 204.824C954.204 204.824 954.512 204.848 954.654 204.872C954.82 204.895 954.915 204.966 954.915 204.99C954.938 205.061 954.938 205.085 954.986 205.109C955.033 205.132 955.104 205.109 955.151 205.014C955.199 204.919 955.223 204.872 955.199 204.753C955.08 204.208 954.18 204.09 953.754 204.066C953.517 204.042 952.498 204.042 952.095 204.042C950.934 204.042 949.797 204.256 948.281 204.564C947.902 204.635 947.072 204.801 947.025 204.801C947.191 204.422 947.286 204.137 947.286 204.019C947.286 203.948 947.309 203.924 947.286 203.877C947.215 203.758 947.144 203.734 946.836 203.711C946.764 203.711 946.693 203.711 946.646 203.711C946.433 203.711 946.385 203.758 946.291 203.9C946.243 203.971 945.912 204.635 945.912 204.706C945.888 204.73 945.746 205.038 945.746 205.085L945.722 205.132L945.248 205.274C943.85 205.701 940.344 206.909 939.704 208.331C939.61 208.568 939.633 208.71 939.704 208.852C939.752 208.947 939.799 208.97 940.107 209.207C940.818 209.752 941.339 210.581 941.765 211.363C942.026 211.813 942.192 212.169 942.168 212.192C942.168 212.192 942.05 212.216 941.884 212.264C940.628 212.619 939.799 212.856 939.444 213.188C939.302 213.306 939.183 213.448 939.159 213.543C939.159 213.59 939.159 213.661 939.207 213.732C939.302 213.875 939.325 213.993 939.491 214.04Z" fill="#292929"/>
    <path d="M947.488 218.4C947.488 218.613 947.749 218.897 947.962 218.897C948.223 218.897 948.294 218.779 948.365 218.518C948.507 217.95 948.697 217.357 948.886 216.812C949.336 215.533 951.019 213.377 952.345 212.808C952.393 212.785 952.44 212.761 952.464 212.761C952.511 212.761 952.464 212.832 952.345 213.045C951.942 213.78 951.658 214.372 951.611 214.775C951.587 214.964 951.611 215.296 951.658 215.438C951.8 215.865 952.179 216.22 952.63 216.22C953.08 216.22 953.696 215.746 954.027 215.486C954.43 215.154 954.525 215.107 954.478 214.988C954.454 214.917 954.383 214.87 954.335 214.87C954.217 214.87 954.17 214.917 954.051 214.988C953.696 215.249 953.34 215.557 953.127 215.675C952.961 215.77 952.795 215.841 952.606 215.865C952.558 215.865 952.487 215.841 952.464 215.817C952.393 215.746 952.369 215.675 952.369 215.533C952.369 215.178 952.487 214.87 952.985 213.922C953.34 213.259 953.435 213.045 953.435 212.832C953.435 212.548 953.246 212.382 952.938 212.335C952.89 212.335 952.866 212.335 952.819 212.335C951.848 212.335 950.545 213.567 949.976 214.348C949.976 214.348 949.905 214.443 949.858 214.514C949.858 214.491 950.189 213.756 950.521 213.022C950.876 212.24 950.971 211.956 951.019 211.671C951.09 211.292 950.9 211.079 950.545 211.079C950.355 211.079 950.26 211.126 950.213 211.245C950.189 211.292 950.142 211.387 950.095 211.458C949.81 211.908 949.123 213.543 948.649 214.704C948.483 215.107 948.128 216.149 948.01 216.481C947.891 216.836 947.488 218.044 947.488 218.4Z" fill="#292929"/>
    <path d="M953.372 217.357C953.419 217.736 953.775 217.926 954.13 217.926C954.177 217.926 954.272 217.902 954.319 217.879C954.438 217.831 954.699 217.689 954.912 217.5C955.125 217.31 955.883 216.599 956.736 215.817C957.707 214.917 958.3 214.372 958.323 214.396C958.347 214.396 958.394 214.68 958.466 215.059C958.537 215.438 958.56 215.675 958.631 215.841C958.75 216.102 958.916 216.339 959.058 216.457C959.2 216.576 959.413 216.623 959.555 216.623C960.1 216.623 961.261 215.438 961.261 215.13C961.261 215.036 961.119 214.964 961.024 214.988C960.953 215.012 960.906 215.059 960.716 215.32C960.645 215.438 959.934 216.173 959.816 216.173C959.555 216.173 959.366 215.012 959.342 214.846C959.271 214.443 959.176 213.922 958.655 213.922C958.56 213.922 958.537 213.922 958.466 213.946C958.394 213.969 958.347 213.993 958.323 213.993C958.205 213.993 957.873 214.23 957.21 214.87C956.926 215.13 954.462 217.5 954.272 217.5C954.248 217.476 954.248 217.405 954.248 217.286C954.248 215.96 956.855 213.211 958.205 213.116C958.252 213.116 958.3 213.116 958.323 213.14C958.371 213.188 958.466 213.282 958.513 213.424C958.584 213.638 958.631 213.709 958.75 213.709C958.774 213.709 958.774 213.709 958.797 213.709C958.916 213.709 958.987 213.567 958.916 213.472C958.892 213.448 958.868 213.377 958.868 213.33C958.868 213.211 958.655 212.903 958.56 212.832C958.276 212.619 958.087 212.619 957.779 212.619C957.684 212.619 957.613 212.619 957.565 212.595C957.447 212.595 957.352 212.619 957.163 212.69C955.623 213.235 953.632 215.083 953.372 216.812C953.348 216.978 953.348 217.239 953.372 217.357Z" fill="#292929"/>
    <path d="M960.554 216.86C960.554 217.12 960.625 217.263 960.862 217.381C960.98 217.452 961.051 217.452 961.099 217.428C961.241 217.428 961.312 217.286 961.383 217.168C961.809 216.291 963.468 214.799 964.439 214.348C964.652 214.254 964.937 214.135 965.031 214.135H965.055V214.277C965.055 214.348 965.031 214.585 964.984 214.822C964.866 215.415 964.866 215.746 964.96 216.078C965.126 216.67 965.482 216.931 966.098 216.931C966.358 216.931 966.5 216.907 966.761 216.789C967.022 216.67 968.372 215.723 968.443 215.533C968.467 215.438 968.419 215.367 968.325 215.32C968.301 215.296 968.277 215.296 968.254 215.296C968.182 215.296 968.111 215.344 967.993 215.462C967.661 215.794 966.642 216.576 966.145 216.576C965.861 216.576 965.742 216.362 965.742 216.102C965.742 215.912 965.79 215.746 965.884 215.344C965.979 214.917 966.026 214.775 966.026 214.585C966.026 214.064 965.79 213.756 965.245 213.732C965.197 213.732 965.126 213.756 965.055 213.756C964.368 213.78 963.255 214.585 962.733 215.059C962.544 215.249 962.046 215.746 961.809 215.983C961.738 216.054 961.691 216.102 961.691 216.102C961.691 216.102 961.715 215.983 961.786 215.817C961.857 215.652 961.904 215.533 961.904 215.509C961.928 215.462 962.117 215.012 962.165 214.87C962.236 214.68 962.378 214.348 962.52 213.993C962.686 213.567 962.781 213.282 962.733 213.116C962.686 212.927 962.52 212.808 962.283 212.785C962.236 212.785 962.212 212.785 962.165 212.785C962.023 212.785 961.857 212.927 961.809 213.069C961.786 213.116 961.738 213.188 961.715 213.211C961.099 214.017 960.719 215.58 960.554 216.599C960.554 216.623 960.554 216.741 960.554 216.86Z" fill="#292929"/>
    <path d="M967.371 218.968C967.465 219.111 967.608 219.158 967.773 219.182C967.821 219.182 967.892 219.158 967.916 219.158C967.987 219.158 968.034 219.087 968.058 219.039C968.081 219.016 968.105 218.874 968.129 218.731C968.224 218.163 968.247 217.784 968.697 216.552C968.768 216.362 968.863 216.054 968.911 215.912C969.005 215.604 969.148 215.178 969.171 215.154C969.171 215.154 969.195 215.178 969.219 215.201C969.882 216.244 971.209 216.907 972.441 216.955C972.535 216.955 972.607 216.931 972.725 216.931C973.602 216.907 975.331 216.031 975.9 215.296C975.971 215.201 975.923 215.036 975.805 214.988C975.71 214.964 975.639 214.988 975.568 215.083C975.118 215.675 974.075 216.22 973.365 216.457C973.08 216.552 972.725 216.599 972.37 216.576C971.375 216.576 969.953 215.817 969.479 214.893C969.479 214.87 969.503 214.87 969.574 214.846C970.711 214.467 973.104 213.022 973.933 212.05C974.075 211.885 974.36 211.553 974.549 211.316C974.834 210.961 974.999 210.676 974.999 210.392C974.999 210.25 974.999 210.155 974.928 210.06C974.857 209.965 974.763 209.918 974.668 209.942C974.644 209.942 974.597 209.942 974.573 209.942C974.478 209.942 974.455 209.965 974.383 210.013C974.36 210.037 974.289 210.131 974.265 210.179C973.649 211.387 972.417 212.335 971.375 213.14C970.948 213.472 969.432 214.467 969.432 214.443C969.408 214.443 969.835 213.401 970.095 212.761C970.522 211.719 970.948 210.676 971.422 209.634C971.659 209.113 971.896 208.568 971.967 208.402C972.109 208.094 972.275 207.715 972.559 207.17C972.725 206.862 972.915 206.577 973.317 205.772C973.388 205.63 973.459 205.464 973.507 205.369C973.673 205.061 973.744 204.943 973.981 204.493C974.336 203.806 974.431 203.616 974.431 203.379C974.431 203.261 974.431 203.237 974.383 203.166C974.312 203.047 974.241 203 974.099 203C974.075 203 974.028 203 974.004 203C973.933 203 973.839 203 973.815 203C973.744 203 973.673 203.047 973.625 203.118C973.602 203.142 973.554 203.166 973.531 203.19C973.507 203.213 973.483 203.261 973.483 203.284C973.459 203.332 973.388 203.45 973.317 203.569C972.725 204.564 972.18 205.606 971.635 206.649C971.067 207.738 970.214 209.421 969.858 210.487C969.835 210.558 969.74 210.747 969.669 210.889C969.076 212.098 969.124 212.192 968.555 213.685C968.058 214.988 967.418 216.718 967.252 218.092C967.205 218.518 967.228 218.779 967.371 218.968Z" fill="#292929"/>
    <path d="M975.364 218.305C975.506 219.395 976.027 220.579 977.283 220.556C978.396 220.532 979.344 218.992 979.818 218.115C979.984 217.808 980.41 216.931 980.671 216.481C980.766 216.339 981.405 215.178 981.405 215.107C981.429 215.012 981.311 214.893 981.192 214.917C981.074 214.941 981.05 214.988 980.718 215.58C980.552 215.865 980.387 216.22 980.316 216.362C979.96 217.049 979.463 217.997 979.226 218.376C978.776 219.087 978.065 220.224 977.117 220.2C977.046 220.2 976.999 220.2 976.928 220.177L976.856 220.153L976.809 220.058C976.785 220.011 976.762 219.963 976.738 219.916C976.691 219.869 976.667 219.821 976.62 219.679C976.501 219.324 976.501 218.968 976.501 218.329C976.501 216.268 977.117 213.614 977.899 211.742C977.97 211.6 978.065 211.316 978.112 211.15C978.396 210.179 978.894 209.326 979.32 208.425C979.628 207.762 979.747 207.501 980.031 206.98C980.339 206.412 980.86 205.488 981.097 205.061C981.5 204.327 981.713 203.948 981.784 203.711C981.879 203.403 981.713 203.095 981.429 203.071C981.382 203.071 981.334 203.071 981.311 203.047C981.287 203.047 981.24 203.024 981.24 203.024C981.168 203.024 981.074 203.071 981.026 203.142C978.681 206.672 976.004 211.861 975.411 216.149C975.364 216.528 975.364 216.694 975.34 216.907C975.293 217.334 975.317 217.902 975.364 218.305Z" fill="#292929"/>
    <path d="M983.646 211.979C983.93 211.695 983.859 211.269 983.48 211.103C983.385 211.055 983.314 211.055 983.219 211.055C982.959 211.055 982.722 211.197 982.627 211.458C982.603 211.553 982.603 211.695 982.651 211.813C982.745 212.027 982.959 212.169 983.196 212.145C983.361 212.145 983.527 212.098 983.646 211.979ZM981.845 217.192C982.106 217.192 982.414 217.12 982.745 216.978C982.935 216.907 983.053 216.812 983.361 216.599C983.622 216.41 983.788 216.315 984.096 216.078C984.664 215.652 984.972 215.32 985.02 215.249C985.091 215.13 984.996 214.988 984.854 214.988C984.807 214.988 984.664 215.059 984.664 215.083C984.664 215.201 983.196 216.268 982.888 216.481C982.603 216.694 982.177 216.836 981.916 216.812C981.869 216.812 981.845 216.812 981.821 216.812C981.774 216.812 981.774 216.812 981.774 216.765C981.774 216.102 982.366 214.585 982.698 213.969C982.888 213.614 982.888 213.519 982.888 213.353C982.888 213.211 982.888 213.188 982.864 213.14C982.769 212.951 982.58 212.832 982.39 212.856C982.248 212.856 982.129 212.856 982.011 212.974C981.585 213.401 980.85 215.036 980.85 215.675C980.826 215.865 980.874 216.244 980.921 216.457C981.016 216.884 981.442 217.168 981.845 217.192Z" fill="#292929"/>
    <path d="M984.361 216.86C984.361 217.12 984.432 217.263 984.669 217.381C984.788 217.452 984.859 217.452 984.906 217.428C985.048 217.428 985.119 217.286 985.191 217.168C985.617 216.291 987.275 214.799 988.247 214.348C988.46 214.254 988.744 214.135 988.839 214.135H988.863V214.277C988.863 214.348 988.839 214.585 988.792 214.822C988.673 215.415 988.673 215.746 988.768 216.078C988.934 216.67 989.289 216.931 989.905 216.931C990.166 216.931 990.308 216.907 990.569 216.789C990.829 216.67 992.18 215.723 992.251 215.533C992.274 215.438 992.227 215.367 992.132 215.32C992.109 215.296 992.085 215.296 992.061 215.296C991.99 215.296 991.919 215.344 991.801 215.462C991.469 215.794 990.45 216.576 989.953 216.576C989.668 216.576 989.55 216.362 989.55 216.102C989.55 215.912 989.597 215.746 989.692 215.344C989.787 214.917 989.834 214.775 989.834 214.585C989.834 214.064 989.597 213.756 989.052 213.732C989.005 213.732 988.934 213.756 988.863 213.756C988.176 213.78 987.062 214.585 986.541 215.059C986.351 215.249 985.854 215.746 985.617 215.983C985.546 216.054 985.499 216.102 985.499 216.102C985.499 216.102 985.522 215.983 985.593 215.817C985.664 215.652 985.712 215.533 985.712 215.509C985.735 215.462 985.925 215.012 985.972 214.87C986.043 214.68 986.186 214.348 986.328 213.993C986.494 213.567 986.588 213.282 986.541 213.116C986.494 212.927 986.328 212.808 986.091 212.785C986.043 212.785 986.02 212.785 985.972 212.785C985.83 212.785 985.664 212.927 985.617 213.069C985.593 213.116 985.546 213.188 985.522 213.211C984.906 214.017 984.527 215.58 984.361 216.599C984.361 216.623 984.361 216.741 984.361 216.86Z" fill="#292929"/>
    <rect x="171" y="264" width="1098" height="977" rx="44" fill="white"/>
    <rect x="171" y="264" width="1098" height="977" rx="44" stroke="#292929" stroke-width="8"/>
  </g>
  <text class="h1"><tspan text-anchor="middle" x="50%" y="500">${profile.name}</tspan></text>
  <text class="h2"><tspan text-anchor="middle" x="50%" y="700">${topic.name}</tspan></text>
  <text class="p"><tspan text-anchor="middle" x="50%" y="900">${topic.value}</tspan></text>
  <text class="s"><tspan text-anchor="middle" x="50%" y="950">(approx.${topic.duration})</tspan></text>

  <text class="s"><tspan text-anchor="middle" x="50%" y="1320">${tokenOwner}</tspan></text>
</svg>
`

function generateTokenImage(profile: ProfileData, topic: TopicData, timeToken: TimeTokenData, tokenOwner: string) {
  const svg = generateSVG(profile, topic, timeToken, tokenOwner)
  const base64 = Buffer.from(svg).toString('base64')
  return `data:image/svg+xml;base64,${base64}`
}

type AttributeData = {
  trait_type: string,
  value: string
}

type TimeMetadata = {
  name: string,
  description: string,
  image: string,
  external_url: string,
  attributes: AttributeData[],
}

const findProfile = async (topicOwner: string): Promise<ProfileData> => {
  const timeTrove: TimeTroveData = await controllerContract.timeTroveOf(topicOwner)
  const { arOwnerAddress } = timeTrove
  const arId = await queryOnChainItemId({
    arOwnerAddress: arOwnerAddress,
    resourceId: '',
    resourceType: ResourceTypes.PROFILE,
    resourceOwner: topicOwner,
  })
  const profile: ProfileData = await fetch(`https://arseed.web3infra.dev/${arId}`).then(res => res.json())
  return profile
}

async function findTopic(topicSlug: string, arId: string): Promise<TopicData|null> {
  const url = `https://arseed.web3infra.dev/${arId}`
  try {
    const topics: TopicData[] = await fetch(url).then(res => res.json())
    const topic = topics.find(({ id }) => id === topicSlug)
    return topic ?? null
  } catch(err) {
    console.log(err)
    return null
  }
}

async function findTimeToken(tokenId: number): Promise<TimeTokenData> {
  const timeToken: TimeTokenData = await controllerContract.timeTokenOf(tokenId)
  return timeToken
}

const handler = async function(
  req: NextApiRequest,
  res: NextApiResponse
) {
  const params = req.query.params as string[]
  if (params.length !== 3) {
    res.status(404).end()
    return
  }
  const [tokenId, topicSlug, arId] = params
  const [tokenOwner, topic, timeToken]: [string, TopicData|null, TimeTokenData] = await Promise.all([
    nftContract.ownerOf(+tokenId),
    findTopic(topicSlug, arId),
    findTimeToken(+tokenId),
  ])
  if (!topic) {
    res.status(404).end()
    return
  }
  const profile = await findProfile(timeToken['topicOwner'])
  const attributes = [
    { trait_type: 'category', value: topic['category'] },
    { trait_type: 'value', value: topic['value'] },
    { trait_type: 'duration', value: topic['duration'] },
    { trait_type: 'method', value: topic['method'] },
    { trait_type: 'valueInWei', value: timeToken['valueInWei'].toString() },
    { trait_type: 'topicOwner', value: timeToken['topicOwner'] },
    { trait_type: 'topicSlug', value: timeToken['topicSlug'] },
    { trait_type: 'arId', value: timeToken['arId'] },
    { trait_type: 'status', value: timeToken['status'] },
  ]
  const metadata = {
    name: topic.name,
    description: topic.description,
    image: generateTokenImage(profile, topic, timeToken, tokenOwner),
    external_url: `https://musetime.xyz/time/${tokenId}`,
    attributes: attributes
  }
  res.status(200).json(metadata)
}

export default handler
